import{R as S,r as d}from"./index-BwDkhjyp.js";import{$ as M}from"./useControlledState-C0C-dzuH.js";class A{build(e,t){return this.context=t,I(()=>this.iterateCollection(e))}*iterateCollection(e){let{children:t,items:l}=e;if(S.isValidElement(t)&&t.type===S.Fragment)yield*this.iterateCollection({children:t.props.children,items:l});else if(typeof t=="function"){if(!l)throw new Error("props.children was a function but props.items is missing");for(let i of e.items)yield*this.getFullNode({value:i},{renderer:t})}else{let i=[];S.Children.forEach(t,r=>{i.push(r)});let n=0;for(let r of i){let o=this.getFullNode({element:r,index:n},{});for(let c of o)n++,yield c}}}getKey(e,t,l,i){if(e.key!=null)return e.key;if(t.type==="cell"&&t.key!=null)return`${i}${t.key}`;let n=t.value;if(n!=null){var r;let o=(r=n.key)!==null&&r!==void 0?r:n.id;if(o==null)throw new Error("No key found for item");return o}return i?`${i}.${t.index}`:`$.${t.index}`}getChildState(e,t){return{renderer:t.renderer||e.renderer}}*getFullNode(e,t,l,i){if(S.isValidElement(e.element)&&e.element.type===S.Fragment){let c=[];S.Children.forEach(e.element.props.children,a=>{c.push(a)});let u=e.index;for(const a of c)yield*this.getFullNode({element:a,index:u++},t,l,i);return}let n=e.element;if(!n&&e.value&&t&&t.renderer){let c=this.cache.get(e.value);if(c&&(!c.shouldInvalidate||!c.shouldInvalidate(this.context))){c.index=e.index,c.parentKey=i?i.key:null,yield c;return}n=t.renderer(e.value)}if(S.isValidElement(n)){let c=n.type;if(typeof c!="function"&&typeof c.getCollectionNode!="function"){let f=typeof n.type=="function"?n.type.name:n.type;throw new Error(`Unknown element <${f}> in collection.`)}let u=c.getCollectionNode(n.props,this.context),a=e.index,g=u.next();for(;!g.done&&g.value;){let f=g.value;e.index=a;let m=f.key;m||(m=f.element?null:this.getKey(n,e,t,l));let K=[...this.getFullNode({...f,key:m,index:a,wrapper:B(e.wrapper,f.wrapper)},this.getChildState(t,f),l?`${l}${n.key}`:n.key,i)];for(let y of K){if(y.value=f.value||e.value,y.value&&this.cache.set(y.value,y),e.type&&y.type!==e.type)throw new Error(`Unsupported type <${$(y.type)}> in <${$(i.type)}>. Only <${$(e.type)}> is supported.`);a++,yield y}g=u.next(K)}return}if(e.key==null)return;let r=this,o={type:e.type,props:e.props,key:e.key,parentKey:i?i.key:null,value:e.value,level:i?i.level+1:0,index:e.index,rendered:e.rendered,textValue:e.textValue,"aria-label":e["aria-label"],wrapper:e.wrapper,shouldInvalidate:e.shouldInvalidate,hasChildNodes:e.hasChildNodes,childNodes:I(function*(){if(!e.hasChildNodes)return;let c=0;for(let u of e.childNodes()){u.key!=null&&(u.key=`${o.key}${u.key}`),u.index=c;let a=r.getFullNode(u,r.getChildState(t,u),o.key,o);for(let g of a)c++,yield g}})};yield o}constructor(){this.cache=new WeakMap}}function I(s){let e=[],t=null;return{*[Symbol.iterator](){for(let l of e)yield l;t||(t=s());for(let l of t)e.push(l),yield l}}}function B(s,e){if(s&&e)return t=>s(e(t));if(s)return s;if(e)return e}function $(s){return s[0].toUpperCase()+s.slice(1)}function U(s,e,t){let l=d.useMemo(()=>new A,[]),{children:i,items:n,collection:r}=s;return d.useMemo(()=>{if(r)return r;let c=l.build({children:i,items:n},t);return e(c)},[l,i,n,r,t,e])}function R(s,e){return typeof e.getChildren=="function"?e.getChildren(s.key):s.childNodes}function _(s){return D(s)}function D(s,e){for(let t of s)return t}function q(s){let e;for(let t of s)e=t;return e}function b(s,e,t){if(e.parentKey===t.parentKey)return e.index-t.index;let l=[...C(s,e),e],i=[...C(s,t),t],n=l.slice(0,i.length).findIndex((r,o)=>r!==i[o]);return n!==-1?(e=l[n],t=i[n],e.index-t.index):l.findIndex(r=>r===t)>=0?1:(i.findIndex(r=>r===e)>=0,-1)}function C(s,e){let t=[];for(;(e==null?void 0:e.parentKey)!=null;)e=s.getItem(e.parentKey),t.unshift(e);return t}class h extends Set{constructor(e,t,l){super(e),e instanceof h?(this.anchorKey=t??e.anchorKey,this.currentKey=l??e.currentKey):(this.anchorKey=t,this.currentKey=l)}}function z(s,e){if(s.size!==e.size)return!1;for(let t of s)if(!e.has(t))return!1;return!0}function T(s){let{selectionMode:e="none",disallowEmptySelection:t,allowDuplicateSelectionEvents:l,selectionBehavior:i="toggle",disabledBehavior:n="all"}=s,r=d.useRef(!1),[,o]=d.useState(!1),c=d.useRef(null),u=d.useRef(null),[,a]=d.useState(null),g=d.useMemo(()=>F(s.selectedKeys),[s.selectedKeys]),f=d.useMemo(()=>F(s.defaultSelectedKeys,new h),[s.defaultSelectedKeys]),[m,w]=M(g,f,s.onSelectionChange),K=d.useMemo(()=>s.disabledKeys?new Set(s.disabledKeys):new Set,[s.disabledKeys]),[y,p]=d.useState(i);i==="replace"&&y==="toggle"&&typeof m=="object"&&m.size===0&&p("replace");let x=d.useRef(i);return d.useEffect(()=>{i!==x.current&&(p(i),x.current=i)},[i]),{selectionMode:e,disallowEmptySelection:t,selectionBehavior:y,setSelectionBehavior:p,get isFocused(){return r.current},setFocused(v){r.current=v,o(v)},get focusedKey(){return c.current},get childFocusStrategy(){return u.current},setFocusedKey(v,E="first"){c.current=v,u.current=E,a(v)},selectedKeys:m,setSelectedKeys(v){(l||!z(v,m))&&w(v)},disabledKeys:K,disabledBehavior:n}}function F(s,e){return s?s==="all"?"all":new h(s):e}class j{get selectionMode(){return this.state.selectionMode}get disallowEmptySelection(){return this.state.disallowEmptySelection}get selectionBehavior(){return this.state.selectionBehavior}setSelectionBehavior(e){this.state.setSelectionBehavior(e)}get isFocused(){return this.state.isFocused}setFocused(e){this.state.setFocused(e)}get focusedKey(){return this.state.focusedKey}get childFocusStrategy(){return this.state.childFocusStrategy}setFocusedKey(e,t){(e==null||this.collection.getItem(e))&&this.state.setFocusedKey(e,t)}get selectedKeys(){return this.state.selectedKeys==="all"?new Set(this.getSelectAllKeys()):this.state.selectedKeys}get rawSelection(){return this.state.selectedKeys}isSelected(e){return this.state.selectionMode==="none"?!1:(e=this.getKey(e),this.state.selectedKeys==="all"?this.canSelectItem(e):this.state.selectedKeys.has(e))}get isEmpty(){return this.state.selectedKeys!=="all"&&this.state.selectedKeys.size===0}get isSelectAll(){if(this.isEmpty)return!1;if(this.state.selectedKeys==="all")return!0;if(this._isSelectAll!=null)return this._isSelectAll;let e=this.getSelectAllKeys(),t=this.state.selectedKeys;return this._isSelectAll=e.every(l=>t.has(l)),this._isSelectAll}get firstSelectedKey(){let e=null;for(let t of this.state.selectedKeys){let l=this.collection.getItem(t);(!e||l&&b(this.collection,l,e)<0)&&(e=l)}return e==null?void 0:e.key}get lastSelectedKey(){let e=null;for(let t of this.state.selectedKeys){let l=this.collection.getItem(t);(!e||l&&b(this.collection,l,e)>0)&&(e=l)}return e==null?void 0:e.key}get disabledKeys(){return this.state.disabledKeys}get disabledBehavior(){return this.state.disabledBehavior}extendSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"){this.replaceSelection(e);return}e=this.getKey(e);let t;if(this.state.selectedKeys==="all")t=new h([e],e,e);else{let n=this.state.selectedKeys;var l;let r=(l=n.anchorKey)!==null&&l!==void 0?l:e;t=new h(n,r,e);var i;for(let o of this.getKeyRange(r,(i=n.currentKey)!==null&&i!==void 0?i:e))t.delete(o);for(let o of this.getKeyRange(e,r))this.canSelectItem(o)&&t.add(o)}this.state.setSelectedKeys(t)}getKeyRange(e,t){let l=this.collection.getItem(e),i=this.collection.getItem(t);return l&&i?b(this.collection,l,i)<=0?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){var l;if(!((l=this.layoutDelegate)===null||l===void 0)&&l.getKeyRange)return this.layoutDelegate.getKeyRange(e,t);let i=[],n=e;for(;n!=null;){let r=this.collection.getItem(n);if((r&&r.type==="item"||r.type==="cell"&&this.allowsCellSelection)&&i.push(n),n===t)return i;n=this.collection.getKeyAfter(n)}return[]}getKey(e){let t=this.collection.getItem(e);if(!t||t.type==="cell"&&this.allowsCellSelection)return e;for(;t.type!=="item"&&t.parentKey!=null;)t=this.collection.getItem(t.parentKey);return!t||t.type!=="item"?null:t.key}toggleSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"&&!this.isSelected(e)){this.replaceSelection(e);return}if(e=this.getKey(e),e==null)return;let t=new h(this.state.selectedKeys==="all"?this.getSelectAllKeys():this.state.selectedKeys);t.has(e)?t.delete(e):this.canSelectItem(e)&&(t.add(e),t.anchorKey=e,t.currentKey=e),!(this.disallowEmptySelection&&t.size===0)&&this.state.setSelectedKeys(t)}replaceSelection(e){if(this.selectionMode==="none"||(e=this.getKey(e),e==null))return;let t=this.canSelectItem(e)?new h([e],e,e):new h;this.state.setSelectedKeys(t)}setSelectedKeys(e){if(this.selectionMode==="none")return;let t=new h;for(let l of e)if(l=this.getKey(l),l!=null&&(t.add(l),this.selectionMode==="single"))break;this.state.setSelectedKeys(t)}getSelectAllKeys(){let e=[],t=l=>{for(;l!=null;){if(this.canSelectItem(l)){let i=this.collection.getItem(l);i.type==="item"&&e.push(l),i.hasChildNodes&&(this.allowsCellSelection||i.type!=="item")&&t(_(R(i,this.collection)).key)}l=this.collection.getKeyAfter(l)}};return t(this.collection.getFirstKey()),e}selectAll(){!this.isSelectAll&&this.selectionMode==="multiple"&&this.state.setSelectedKeys("all")}clearSelection(){!this.disallowEmptySelection&&(this.state.selectedKeys==="all"||this.state.selectedKeys.size>0)&&this.state.setSelectedKeys(new h)}toggleSelectAll(){this.isSelectAll?this.clearSelection():this.selectAll()}select(e,t){this.selectionMode!=="none"&&(this.selectionMode==="single"?this.isSelected(e)&&!this.disallowEmptySelection?this.toggleSelection(e):this.replaceSelection(e):this.selectionBehavior==="toggle"||t&&(t.pointerType==="touch"||t.pointerType==="virtual")?this.toggleSelection(e):this.replaceSelection(e))}isSelectionEqual(e){if(e===this.state.selectedKeys)return!0;let t=this.selectedKeys;if(e.size!==t.size)return!1;for(let l of e)if(!t.has(l))return!1;for(let l of t)if(!e.has(l))return!1;return!0}canSelectItem(e){var t;if(this.state.selectionMode==="none"||this.state.disabledKeys.has(e))return!1;let l=this.collection.getItem(e);return!(!l||!(l==null||(t=l.props)===null||t===void 0)&&t.isDisabled||l.type==="cell"&&!this.allowsCellSelection)}isDisabled(e){var t,l;return this.state.disabledBehavior==="all"&&(this.state.disabledKeys.has(e)||!!(!((l=this.collection.getItem(e))===null||l===void 0||(t=l.props)===null||t===void 0)&&t.isDisabled))}isLink(e){var t,l;return!!(!((l=this.collection.getItem(e))===null||l===void 0||(t=l.props)===null||t===void 0)&&t.href)}getItemProps(e){var t;return(t=this.collection.getItem(e))===null||t===void 0?void 0:t.props}constructor(e,t,l){this.collection=e,this.state=t;var i;this.allowsCellSelection=(i=l==null?void 0:l.allowsCellSelection)!==null&&i!==void 0?i:!1,this._isSelectAll=null,this.layoutDelegate=(l==null?void 0:l.layoutDelegate)||null}}export{T as $,U as a,j as b,R as c,q as d,_ as e};
