import{g as V}from"./useFocusable-DySem7st.js";import{b as B,c as N}from"./useFocusRing-BuOUPy6p.js";import{$ as h}from"./SSRProvider-4hSGecE0.js";import{r as m,R as S}from"./index-BEEaWAwe.js";function j(e){const t=B(e);if(!(e instanceof t.HTMLElement)&&!(e instanceof t.SVGElement))return!1;let{display:n,visibility:o}=e.style,r=n!=="none"&&o!=="hidden"&&o!=="collapse";if(r){const{getComputedStyle:i}=e.ownerDocument.defaultView;let{display:d,visibility:a}=i(e);r=d!=="none"&&a!=="hidden"&&a!=="collapse"}return r}function z(e,t){return!e.hasAttribute("hidden")&&!e.hasAttribute("data-react-aria-prevent-focus")&&(e.nodeName==="DETAILS"&&t&&t.nodeName!=="SUMMARY"?e.hasAttribute("open"):!0)}function I(e,t){return e.nodeName!=="#comment"&&j(e)&&z(e,t)&&(!e.parentElement||I(e.parentElement,e))}const K=S.createContext(null),_="react-aria-focus-scope-restore";let c=null;function ne(e){let{children:t,contain:n,restoreFocus:o,autoFocus:r}=e,i=m.useRef(null),d=m.useRef(null),a=m.useRef([]),{parentNode:p}=m.useContext(K)||{},u=m.useMemo(()=>new M({scopeRef:a}),[a]);h(()=>{let b=p||v.root;if(v.getTreeNode(b.scopeRef)&&c&&!R(c,b.scopeRef)){let s=v.getTreeNode(c);s&&(b=s)}b.addChild(u),v.addNode(u)},[u,p]),h(()=>{let b=v.getTreeNode(a);b&&(b.contain=!!n)},[n]),h(()=>{var b;let s=(b=i.current)===null||b===void 0?void 0:b.nextSibling,$=[],w=F=>F.stopPropagation();for(;s&&s!==d.current;)$.push(s),s.addEventListener(_,w),s=s.nextSibling;return a.current=$,()=>{for(let F of $)F.removeEventListener(_,w)}},[t]),J(a,o,n),W(a,n),Q(a,o,n),G(a,r),m.useEffect(()=>{const b=N(a.current?a.current[0]:void 0).activeElement;let s=null;if(E(b,a.current)){for(let $ of v.traverse())$.scopeRef&&E(b,$.scopeRef.current)&&(s=$);s===v.getTreeNode(a)&&(c=s.scopeRef)}},[a]),h(()=>()=>{var b,s,$;let w=($=(s=v.getTreeNode(a))===null||s===void 0||(b=s.parent)===null||b===void 0?void 0:b.scopeRef)!==null&&$!==void 0?$:null;(a===c||R(a,c))&&(!w||v.getTreeNode(w))&&(c=w),v.removeTreeNode(a)},[a]);let l=m.useMemo(()=>U(a),[]),f=m.useMemo(()=>({focusManager:l,parentNode:u}),[u,l]);return S.createElement(K.Provider,{value:f},S.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:i}),t,S.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:d}))}function U(e){return{focusNext(t={}){let n=e.current,{from:o,tabbable:r,wrap:i,accept:d}=t,a=o||N(n[0]).activeElement,p=n[0].previousElementSibling,u=y(n),l=g(u,{tabbable:r,accept:d},n);l.currentNode=E(a,n)?a:p;let f=l.nextNode();return!f&&i&&(l.currentNode=p,f=l.nextNode()),f&&T(f,!0),f},focusPrevious(t={}){let n=e.current,{from:o,tabbable:r,wrap:i,accept:d}=t,a=o||N(n[0]).activeElement,p=n[n.length-1].nextElementSibling,u=y(n),l=g(u,{tabbable:r,accept:d},n);l.currentNode=E(a,n)?a:p;let f=l.previousNode();return!f&&i&&(l.currentNode=p,f=l.previousNode()),f&&T(f,!0),f},focusFirst(t={}){let n=e.current,{tabbable:o,accept:r}=t,i=y(n),d=g(i,{tabbable:o,accept:r},n);d.currentNode=n[0].previousElementSibling;let a=d.nextNode();return a&&T(a,!0),a},focusLast(t={}){let n=e.current,{tabbable:o,accept:r}=t,i=y(n),d=g(i,{tabbable:o,accept:r},n);d.currentNode=n[n.length-1].nextElementSibling;let a=d.previousNode();return a&&T(a,!0),a}}}const A=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],q=A.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";A.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const H=A.join(':not([hidden]):not([tabindex="-1"]),');function y(e){return e[0].parentElement}function x(e){let t=v.getTreeNode(c);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function W(e,t){let n=m.useRef(void 0),o=m.useRef(void 0);h(()=>{let r=e.current;if(!t){o.current&&(cancelAnimationFrame(o.current),o.current=void 0);return}const i=N(r?r[0]:void 0);let d=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!x(e)||u.isComposing)return;let l=i.activeElement,f=e.current;if(!f||!E(l,f))return;let b=y(f),s=g(b,{tabbable:!0},f);if(!l)return;s.currentNode=l;let $=u.shiftKey?s.previousNode():s.nextNode();$||(s.currentNode=u.shiftKey?f[f.length-1].nextElementSibling:f[0].previousElementSibling,$=u.shiftKey?s.previousNode():s.nextNode()),u.preventDefault(),$&&T($,!0)},a=u=>{(!c||R(c,e))&&E(u.target,e.current)?(c=e,n.current=u.target):x(e)&&!L(u.target,e)?n.current?n.current.focus():c&&c.current&&C(c.current):x(e)&&(n.current=u.target)},p=u=>{o.current&&cancelAnimationFrame(o.current),o.current=requestAnimationFrame(()=>{if(i.activeElement&&x(e)&&!L(i.activeElement,e))if(c=e,i.body.contains(u.target)){var l;n.current=u.target,(l=n.current)===null||l===void 0||l.focus()}else c.current&&C(c.current)})};return i.addEventListener("keydown",d,!1),i.addEventListener("focusin",a,!1),r==null||r.forEach(u=>u.addEventListener("focusin",a,!1)),r==null||r.forEach(u=>u.addEventListener("focusout",p,!1)),()=>{i.removeEventListener("keydown",d,!1),i.removeEventListener("focusin",a,!1),r==null||r.forEach(u=>u.removeEventListener("focusin",a,!1)),r==null||r.forEach(u=>u.removeEventListener("focusout",p,!1))}},[e,t]),h(()=>()=>{o.current&&cancelAnimationFrame(o.current)},[o])}function O(e){return L(e)}function E(e,t){return!e||!t?!1:t.some(n=>n.contains(e))}function L(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:n}of v.traverse(v.getTreeNode(t)))if(n&&E(e,n.current))return!0;return!1}function re(e){return L(e,c)}function R(e,t){var n;let o=(n=v.getTreeNode(t))===null||n===void 0?void 0:n.parent;for(;o;){if(o.scopeRef===e)return!0;o=o.parent}return!1}function T(e,t=!1){if(e!=null&&!t)try{V(e)}catch{}else if(e!=null)try{e.focus()}catch{}}function P(e,t=!0){let n=e[0].previousElementSibling,o=y(e),r=g(o,{tabbable:t},e);r.currentNode=n;let i=r.nextNode();return t&&!i&&(o=y(e),r=g(o,{tabbable:!1},e),r.currentNode=n,i=r.nextNode()),i}function C(e,t=!0){T(P(e,t))}function G(e,t){const n=S.useRef(t);m.useEffect(()=>{if(n.current){c=e;const o=N(e.current?e.current[0]:void 0);!E(o.activeElement,c.current)&&e.current&&C(e.current)}n.current=!1},[e])}function J(e,t,n){h(()=>{if(t||n)return;let o=e.current;const r=N(o?o[0]:void 0);let i=d=>{let a=d.target;E(a,e.current)?c=e:O(a)||(c=null)};return r.addEventListener("focusin",i,!1),o==null||o.forEach(d=>d.addEventListener("focusin",i,!1)),()=>{r.removeEventListener("focusin",i,!1),o==null||o.forEach(d=>d.removeEventListener("focusin",i,!1))}},[e,t,n])}function Y(e){let t=v.getTreeNode(c);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(t==null?void 0:t.scopeRef)===e}function Q(e,t,n){const o=m.useRef(typeof document<"u"?N(e.current?e.current[0]:void 0).activeElement:null);h(()=>{let r=e.current;const i=N(r?r[0]:void 0);if(!t||n)return;let d=()=>{(!c||R(c,e))&&E(i.activeElement,e.current)&&(c=e)};return i.addEventListener("focusin",d,!1),r==null||r.forEach(a=>a.addEventListener("focusin",d,!1)),()=>{i.removeEventListener("focusin",d,!1),r==null||r.forEach(a=>a.removeEventListener("focusin",d,!1))}},[e,n]),h(()=>{const r=N(e.current?e.current[0]:void 0);if(!t)return;let i=d=>{if(d.key!=="Tab"||d.altKey||d.ctrlKey||d.metaKey||!x(e)||d.isComposing)return;let a=r.activeElement;if(!E(a,e.current))return;let p=v.getTreeNode(e);if(!p)return;let u=p.nodeToRestore,l=g(r.body,{tabbable:!0});l.currentNode=a;let f=d.shiftKey?l.previousNode():l.nextNode();if((!u||!r.body.contains(u)||u===r.body)&&(u=void 0,p.nodeToRestore=void 0),(!f||!E(f,e.current))&&u){l.currentNode=u;do f=d.shiftKey?l.previousNode():l.nextNode();while(E(f,e.current));d.preventDefault(),d.stopPropagation(),f?T(f,!0):O(u)?T(u,!0):a.blur()}};return n||r.addEventListener("keydown",i,!0),()=>{n||r.removeEventListener("keydown",i,!0)}},[e,t,n]),h(()=>{const r=N(e.current?e.current[0]:void 0);if(!t)return;let i=v.getTreeNode(e);if(i){var d;return i.nodeToRestore=(d=o.current)!==null&&d!==void 0?d:void 0,()=>{let a=v.getTreeNode(e);if(!a)return;let p=a.nodeToRestore;if(t&&p&&(E(r.activeElement,e.current)||r.activeElement===r.body&&Y(e))){let u=v.clone();requestAnimationFrame(()=>{if(r.activeElement===r.body){let l=u.getTreeNode(e);for(;l;){if(l.nodeToRestore&&l.nodeToRestore.isConnected){D(l.nodeToRestore);return}l=l.parent}for(l=u.getTreeNode(e);l;){if(l.scopeRef&&l.scopeRef.current&&v.getTreeNode(l.scopeRef)){let f=P(l.scopeRef.current,!0);D(f);return}l=l.parent}}})}}}},[e,t])}function D(e){e.dispatchEvent(new CustomEvent(_,{bubbles:!0,cancelable:!0}))&&T(e)}function g(e,t,n){let o=t!=null&&t.tabbable?H:q,r=N(e).createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(i){var d;return!(t==null||(d=t.from)===null||d===void 0)&&d.contains(i)?NodeFilter.FILTER_REJECT:i.matches(o)&&I(i)&&(!n||E(i,n))&&(!(t!=null&&t.accept)||t.accept(i))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t!=null&&t.from&&(r.currentNode=t.from),r}class k{get size(){return this.fastMap.size}getTreeNode(t){return this.fastMap.get(t)}addTreeNode(t,n,o){let r=this.fastMap.get(n??null);if(!r)return;let i=new M({scopeRef:t});r.addChild(i),i.parent=r,this.fastMap.set(t,i),o&&(i.nodeToRestore=o)}addNode(t){this.fastMap.set(t.scopeRef,t)}removeTreeNode(t){if(t===null)return;let n=this.fastMap.get(t);if(!n)return;let o=n.parent;for(let i of this.traverse())i!==n&&n.nodeToRestore&&i.nodeToRestore&&n.scopeRef&&n.scopeRef.current&&E(i.nodeToRestore,n.scopeRef.current)&&(i.nodeToRestore=n.nodeToRestore);let r=n.children;o&&(o.removeChild(n),r.size>0&&r.forEach(i=>o&&o.addChild(i))),this.fastMap.delete(n.scopeRef)}*traverse(t=this.root){if(t.scopeRef!=null&&(yield t),t.children.size>0)for(let n of t.children)yield*this.traverse(n)}clone(){var t;let n=new k;var o;for(let r of this.traverse())n.addTreeNode(r.scopeRef,(o=(t=r.parent)===null||t===void 0?void 0:t.scopeRef)!==null&&o!==void 0?o:null,r.nodeToRestore);return n}constructor(){this.fastMap=new Map,this.root=new M({scopeRef:null}),this.fastMap.set(null,this.root)}}class M{addChild(t){this.children.add(t),t.parent=this}removeChild(t){this.children.delete(t),t.parent=void 0}constructor(t){this.children=new Set,this.contain=!1,this.scopeRef=t.scopeRef}}let v=new k;export{re as $,ne as a,g as b};
